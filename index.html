<!doctype html>
<html>
	<head>
		<!-- <link rel="stylesheet" type="text/css" media='all' href="CSS/index.css"> -->
		<title>Chat</title>
		<Style>
		* { 
	margin: 0; 
	padding: 0; 
	box-sizing: border-box; 
	background: #EBF5FF;
}

body { 
	font: 13px Helvetica, Arial; 
}

form { 
	background: #000; 
	padding: 3px; 
	position: fixed; 
	bottom: 0; 
	width: 100%; 
}

form input { 
	border: 0; 
	padding: 10px; 
	width: 90%; 
	margin-right: .5%; 
}

form button { 
	width: 9%; 
	background: rgb(130, 224, 255); 
	border: none; 
	padding: 10px; 
}

#header {
	font-size: 28;
	position: fixed;
	top: -10px;
	/*margin-left: 33%;*/
	font-weight: Bold;
	width: 78%;
	height: 20px;
	padding-top: 20px;
	padding-bottom: 40px;
	z-index: 1;
}

#header h1 {
	text-align: center;
}

.friends {
	position: fixed;
	z-index: 2;
	right: 4%; /*80px;*/
	top: 4%;
	font-size: 20px;
	border-radius: 10px;
	border: black solid 2px;
	width: 20%;
	height: 90%;
	padding-top: 1%;
	padding-left: .5%;
	padding-right: .5%;
	padding-bottom: 5%;
	text-align: center;
	list-style-type: none;
	text-align: center;
	background-color: #B8DBFF;
}

.friends li {
	font-size: 16px;
	padding: 5px;
	font-weight: none;
	background: #B8DBFF;
}

.friends h3 {
	background: #B8DBFF;
}
#messages { 
	clear: both;
	list-style-type: none; 
	margin: .1%; 
	margin-top: 3%;
	margin-bottom: 5%;
	padding: 0;
	
}
#messages li { 
	padding: 5px 10px; 
	border-radius: 10px; 
	margin: 10px;
	width: 75%;
}
#messages li:nth-child(odd) {
 background: #EBD6FF; 
}
#messages li:nth-child(even) {
	background: #CECEF8;
}
</style>
    </head>
    <body>
    	<div id='header'>
    		<h1>Rohan's Amazing Chat Room!</h1>
    		
    	</div>
		<div class='friends'>
			<h3>Friends Online<h3>
			<li>You should try making some friends</li>
		</div>

    	<ul id='messages'></ul>
    	<form action=''>
    		<input id='m' autocomplete = 'off' autofocus /><button>Send</button>
		</form>

	<script src="/socket.io/socket.io.js"></script>
	<script src="http://code.jquery.com/jquery-1.11.1.js"></script>
	<script>
		var user = prompt("please enter name:");
		var socket = io();
		index = 0;
		// document.cookie = index;
		socket.emit('connected', [user, '>>> ' + user + ' has connected']);
		user = user + ": ";

		function pageScroll() { 
		    window.scrollBy(0,35);
		}
		// function notFocus() {

		//   if ($(document.activeElement).attr("type") == "text" || $(document.activeElement).attr("type") == "textarea") {
		//   return false;
		//  } else {
		//  	return true;
		//  }
		// }


		var blur;
		window.onblur = notification;
		window.onfocus = disable_notif;

		function notification() {
			blur = true;
		}

		function disable_notif() {
			blur = false
		}

		function PlaySound(soundObj) {
		  var sound = document.getElementById(soundObj);
		  sound.play();
		}
		</script>
		<audio id='sound1' src="http://themushroomkingdom.net/sounds/wav/smw/smw_coin.wav" preload='auto' autostart="false" width="0" height="0"
		enablejavascript="true"></audio>
		<script>
		// var searchTimeout;
		// document.getElementById('form').onkeypress = function () {
	 //        if (searchTimeout != undefined) clearTimeout(searchTimeout);
	 //        searchTimeout = setTimeout(callServerScript, 250);
  //   	};
  //   	function callServerScript() {
  //   		socket.emit()
  //   	}

		$('form').submit(function(){
			socket.emit('chat message', user + $('#m').val());
			$('#m').val('');
			return false;
		});
		socket.on('chat message', function(msg){
			$('#messages').append($('<li>').text(msg));
			pageScroll();
			if (blur) {//user is in a different tab
				console.log('user not paying attention');
				PlaySound('sound1');
				$(document).attr("title", '(1) chat');

			}
		});	
		socket.on('connected', function(msg){
			$('#messages').append($('<li>').text(msg));
			pageScroll();
			if (blur) {//user is in a different tab
				console.log('user not paying attention');
				PlaySound('sound1');
				$(document).attr("title", '(1) chat');
			}
		});

		socket.on('disconnect', function(msg){
			$('#messages').append($('<li>').text(msg));
			pageScroll();
			if (blur) {//user is in a different tab
				console.log('user not paying attention');
				PlaySound('sound1');
				$(document).attr("title", '(1) chat');
			}
		})
	</script>
	</body>
</html>